--  ********************************************************************** 
--  Note: This rebuild script is not meant to be used when a possibility * 
--        exists that someone might try to access the table while it is  * 
--        being rebuilt!                                                 * 
--                                                                       * 
--        Locks are released when the first DDL, COMMIT or ROLLBACK is   * 
--        performed, so adding a "Lock table" command at the top of this * 
--        script will not prevent others from accessing the table for    * 
--        the duration of the script.                                    * 
--                                                                       * 
--   One more important note:                                            * 
--        This script will cause the catalog in replicated environments  * 
--        to become out of sync.                                         * 
--  ********************************************************************** 

--  Table Rebuild script generated by TOAD  
--  
--  Original table: DICAFIBP18 
--  Backup of table: DICAFIBP18_X 
--  Date: 08.08.2007 21:46:02 
--  
SET LINESIZE 200
--  
--  Make backup copy of original table 
ALTER TABLE PARUS.DICAFIBP18 RENAME TO DICAFIBP18_X ; 
  
 

-- Drop all user named constraints
ALTER TABLE PARUS.DICAFIBP18_X DROP CONSTRAINT C_DICAFIBP18_ACC_NUMB_NB ;
ALTER TABLE PARUS.DICAFIBP18_X DROP CONSTRAINT C_DICAFIBP18_GTD_NB ;
ALTER TABLE PARUS.DICAFIBP18_X DROP CONSTRAINT C_DICAFIBP18_PREF_NB ;
ALTER TABLE PARUS.DICAFIBP18_X DROP CONSTRAINT C_DICAFIBP18_REG_NB ;
ALTER TABLE PARUS.DICAFIBP18_X DROP CONSTRAINT C_DICAFIBP18_RN_PK ;

--  Recreate original table 
CREATE TABLE PARUS.DICAFIBP18
(
  RN            NUMBER(17)                      NOT NULL,
  COMPANY       NUMBER(17)                      NOT NULL,
  AUTHID        VARCHAR2(30 BYTE)               NOT NULL,
  IDENT         NUMBER(17)                      DEFAULT 0                     NOT NULL,
  PREF_NUMB     VARCHAR2(10 BYTE)               NOT NULL,
  REG_NUMB      VARCHAR2(10 BYTE)               NOT NULL,
  ACC_DATE      DATE                            DEFAULT SYSDATE               NOT NULL,
  INCOME_DATE   DATE                            DEFAULT null,
  ONCOME_DATE   DATE                            DEFAULT null,
  PAY_DATE      DATE                            DEFAULT null,
  PR_CODE       NUMBER(17)                      NOT NULL,
  CS_CODE       NUMBER(17)                      NOT NULL,
  SUM_WOUT20    NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  RATE_NDS20    NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  SUM_NDS20     NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  SUM_WOUT18    NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  RATE_NDS18    NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  SUM_NDS18     NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  SUM_WOUT10    NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  RATE_NDS10    NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  SUM_NDS10     NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  SUM_NOT_NDS   NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  SUM_TOTAL     NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  ACC_NUMB      VARCHAR2(20 BYTE)               NOT NULL,
  SUM_NSP       NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  SUM_NDS_FREE  NUMBER(17,2)                    DEFAULT 0                     NOT NULL,
  COUNTRY       NUMBER(17)                      DEFAULT null,
  GTD           VARCHAR2(40 BYTE)               DEFAULT null
)
TABLESPACE PARUSTEMP
PCTUSED    40
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          128K
            MINEXTENTS       1
            MAXEXTENTS       2147483645
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           )
NOLOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
NOMONITORING;
 
--  Copy the data from the renamed table  
INSERT /*+ APPEND */
INTO PARUS.DICAFIBP18 INS_TBL
(RN, COMPANY, AUTHID, IDENT, 
PREF_NUMB, REG_NUMB, ACC_DATE, INCOME_DATE, 
ONCOME_DATE, PAY_DATE, PR_CODE, CS_CODE, 
SUM_WOUT20, RATE_NDS20, SUM_NDS20, SUM_WOUT18, 
RATE_NDS18, SUM_NDS18, SUM_WOUT10, RATE_NDS10, 
SUM_NDS10, SUM_NOT_NDS, SUM_TOTAL, ACC_NUMB, 
SUM_NSP, SUM_NDS_FREE, COUNTRY, GTD)
SELECT 
RN, COMPANY, AUTHID, IDENT, 
PREF_NUMB, REG_NUMB, ACC_DATE, INCOME_DATE, 
ONCOME_DATE, PAY_DATE, PR_CODE, CS_CODE, 
SUM_WOUT20, RATE_NDS20, SUM_NDS20, SUM_WOUT18, 
RATE_NDS18, SUM_NDS18, SUM_WOUT10, RATE_NDS10, 
SUM_NDS10, SUM_NOT_NDS, SUM_TOTAL, ACC_NUMB, 
SUM_NSP, SUM_NDS_FREE, COUNTRY, GTD
FROM PARUS.DICAFIBP18_X SEL_TBL ; 
  
Commit ; 
  

-- Drop all other user named indexes 
-- (none) 


 
--  DROP the renamed table  
 
DROP TABLE PARUS."DICAFIBP18_X" ; 
  
 
ALTER TABLESPACE PARUSTMP COALESCE  ; 
  


--  Recreate Indexes, Constraints, and Grants 

CREATE UNIQUE INDEX PARUS.C_DICAFIBP18_RN_PK ON PARUS.DICAFIBP18
(RN)
NOLOGGING
TABLESPACE PARUSTMPIDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          128K
            MINEXTENTS       1
            MAXEXTENTS       2147483645
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL
COMPUTE STATISTICS
ONLINE;


ALTER TABLE PARUS.DICAFIBP18 ADD (
  CONSTRAINT C_DICAFIBP18_ACC_NUMB_NB
 CHECK ( rtrim(ACC_NUMB) is not null ));

ALTER TABLE PARUS.DICAFIBP18 ADD (
  CONSTRAINT C_DICAFIBP18_GTD_NB
 CHECK (GTD is null or rtrim(GTD) is not null));

ALTER TABLE PARUS.DICAFIBP18 ADD (
  CONSTRAINT C_DICAFIBP18_PREF_NB
 CHECK ( rtrim(PREF_NUMB) is not null ));

ALTER TABLE PARUS.DICAFIBP18 ADD (
  CONSTRAINT C_DICAFIBP18_REG_NB
 CHECK ( rtrim(REG_NUMB) is not null ));

ALTER TABLE PARUS.DICAFIBP18 ADD (
  CONSTRAINT C_DICAFIBP18_RN_PK
 PRIMARY KEY
 (RN)
    USING INDEX 
    TABLESPACE PARUSTMPIDX
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          128K
                MINEXTENTS       1
                MAXEXTENTS       2147483645
                PCTINCREASE      0
                FREELISTS        1
                FREELIST GROUPS  1
               ));
 
--  There are no FKeys that reference the new table to recreate. 
 

--  Analyze New Table 
Analyze Table PARUS.DICAFIBP18 Compute Statistics;

 
--  Recompile any dependent objects 
 
ALTER PROCEDURE "PARUS"."P_DICAFIBP18_BASE_INSERT" COMPILE ; 
  
ALTER PROCEDURE "PARUS"."P_DICAFIBP18_PACK_BY_IDENT" COMPILE ; 
  
ALTER VIEW "PARUS"."V_DICAFIBP18" COMPILE ; 
  
--  There are no triggers to rebuild.
